package com.example.game;

import android.util.Log;
import android.view.View;
import android.widget.RelativeLayout;
import android.widget.TextView;

public class BuildUpdataView{
	private GameData sd;
	
	private static BuildUpdataView v = null;
	
	private RelativeLayout view_layout;
	private TextView txt_title;
	private TextView txt_cur_level;
	private TextView txt_yield_sec;
	private TextView txt_yield_total;
	private TextView txt_next_add;
	private TextView txt_build_info;
	private TextView txt_cost_updata;

	public GameData.building cur_select = GameData.building.MZ;
	
	private BuildUpdataView(View view)
	{
		sd = GameData.CreateData();
		view_layout = (RelativeLayout) view.findViewById(R.id.build_info);
		
		txt_title = (TextView) view.findViewById(R.id.build_name);
		txt_cur_level = (TextView) view.findViewById(R.id.txt_Level);
		txt_yield_sec = (TextView) view.findViewById(R.id.txt_yield_sec);
		txt_yield_total = (TextView) view.findViewById(R.id.txt_yield_total);
		txt_next_add = (TextView) view.findViewById(R.id.txt_next_add);
		txt_build_info = (TextView) view.findViewById(R.id.txt_info);
		txt_cost_updata = (TextView) view.findViewById(R.id.txt_cost);
		
        view_layout.setVisibility(4); //隐藏
	}
	public static BuildUpdataView CreateView(View view)
	{
		if (null == v && null != view)
		{
			v = new BuildUpdataView(view);
		}
		return v;
	}

	public void setBuild(GameData.building b)
	{
		UIupdata(b);
		view_layout.setVisibility(0);//show
		cur_select = b;
	}
	private String StrPreOper(String str)
    {
        int loc = 0, len = str.length();
        char[] re = new char[str.length() + str.length() / 3 + 1];
        char[] source = new char[len + len / 4 + 1];
        str.getChars(0, len, source, 0);

        if (len > 8)
        {
            System.arraycopy(source, len >= 12 ? len - 12 : 0, re, loc, len >= 12 ? 4 : len % 4);
            loc += (len >= 12 ? 4 : len % 4);
            re[loc++] = '亿';
        }
        if (len > 4)
        {
            System.arraycopy(source, len >= 8 ? len - 8 : 0, re, loc, len >= 8 ? 4 : len % 4);
            loc += (len >= 8 ? 4 : len % 4);
            re[loc++] = '万';
        }
        if (len > 0)
        {
            System.arraycopy(source, len >= 4 ? len - 4 : 0, re, loc, len >= 4 ? 4 : len % 4);
            loc += (len >= 4 ? 4 : len % 4);
        }
        return new String(re, 0, loc);
    }
	
	public void UIupdata(GameData.building b)
	{
		txt_title.setText(sd.get_build_name(b));
		txt_cur_level.setText(sd.get_build_level(b));
		txt_yield_sec.setText(StrPreOper(sd.get_yield_sec(b)));
		txt_yield_total.setText(StrPreOper(sd.get_yield_total(b)));
		txt_build_info.setText(sd.get_build_info(b));
		txt_next_add.setText(StrPreOper(sd.get_build_next_add(b)));
		txt_cost_updata.setText("升级花费:" + StrPreOper(sd.get_build_updata_cost(b)));
	}
	public void hide()
	{
		view_layout.setVisibility(4);
	}
}
